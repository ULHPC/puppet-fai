#!/bin/bash
################################################################################
# <%= scope.lookupvar('fai::params::nfsroot_hookdir') %>/10-blacklist-module
#
#       _   _ _____ ____  ____   ___   ___ _____   _   _             _
#      | \ | |  ___/ ___||  _ \ / _ \ / _ \_   _| | | | | ___   ___ | | __
#      |  \| | |_  \___ \| |_) | | | | | | || |   | |_| |/ _ \ / _ \| |/ /
#      | |\  |  _|  ___) |  _ <| |_| | |_| || |   |  _  | (_) | (_) |   <
#      |_| \_|_|   |____/|_| \_\\___/ \___/ |_|   |_| |_|\___/ \___/|_|\_\
#
################################################################################
# Shell scripts to be sourced at the end of make-fai-nfsroot for additional
# configuration of the nfsroot - here the reconfiguration of the initrd to
# include a set of kernel modules (network card typically)
################################################################################
#" /!\ DO NOT EDIT THIS FILE: it has been automatically generated by Puppet.
#      In particular, any further changes will be overwritten at the next
#      puppet invocation
################################################################################

echo "*** Enter blacklist module hook ***"

echo "=> remove the following modules to the initrd: nouveau"
cat >> ${NFSROOT}/etc/modprobe.d/nouveau-blacklist.conf  <<EOF
# Blacklist opensource NVIDIAmodules
blacklist nouveau
EOF

echo "Exit blacklist module hook"
